// src/styles/components/_dialog.scss
@use "../../styles/abstract/base" as base;
@use "../../styles/abstract/variables" as v;
@use "../../styles/abstract/functions" as f;
@use "../../styles/abstract/mixins" as m;
@use "../../styles/abstract/theme" as t;

$component: "#{base.$prefix}-dialog";

// Dialog overlay (background scrim)
// MD3 specifies 32% opacity for scrim
.#{$component}-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: t.alpha("scrim", 0.32);
    opacity: 0;
    visibility: hidden;
    z-index: v.z-index("modal");
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: auto;
    padding: 24px;
    box-sizing: border-box;

    // MD3 standard animation for overlay
    transition:
        opacity v.motion("duration-medium1") v.motion("easing-emphasized"),
        visibility v.motion("duration-medium1") v.motion("easing-emphasized");

    &--visible {
        opacity: 1;
        visibility: visible;
    }
}

// Dialog container
// MD3: surface-container-high, 28dp corners, elevation 3
.#{$component} {
    position: relative;
    background-color: t.color("surface-container-high");
    color: t.color("on-surface");
    border-radius: v.shape("extra-large"); // 28dp corner radius
    max-width: 560px;
    min-width: 280px;
    width: 100%;
    margin: auto;
    @include m.elevation(3);

    // Initial state - hidden with scaleY for MD3 reveal animation (like menu)
    opacity: 0;
    transform-origin: center center;
    transform: scaleY(0);
    pointer-events: none;

    // MD3 emphasized easing for dialogs
    transition:
        transform v.motion("duration-medium1") v.motion("easing-emphasized"),
        opacity v.motion("duration-medium1") v.motion("easing-emphasized");

    // Visible state
    &--visible {
        opacity: 1;
        transform: scaleY(1);
        pointer-events: auto;
    }

    // Size variants
    &--small {
        width: 80%;
        max-width: 360px;
    }

    &--medium {
        width: 90%;
        max-width: 560px;
    }

    &--large {
        width: 95%;
        max-width: 800px;
    }

    &--fullwidth {
        width: 100%;
        max-width: none;
        margin: 24px;
    }

    &--fullscreen {
        width: 100%;
        height: 100%;
        max-width: none;
        max-height: none;
        margin: 0;
        border-radius: 0;
        transform-origin: center center;

        // Fullscreen uses scale instead of scaleY for better appearance
        transform: scale(0.9);

        &.#{$component}--visible {
            transform: scale(1);
        }
    }

    // Animation variants with appropriate transform origins
    &--slide-up {
        transform-origin: bottom center;
        transform: scaleY(0);

        &.#{$component}--visible {
            transform: scaleY(1);
        }
    }

    &--slide-down {
        transform-origin: top center;
        transform: scaleY(0);

        &.#{$component}--visible {
            transform: scaleY(1);
        }
    }

    &--fade {
        transform: scaleY(1);

        &.#{$component}--visible {
            transform: scaleY(1);
        }
    }

    // Scale animation variant (original behavior)
    &--scale {
        transform-origin: center center;
        transform: scale(0.8);

        &.#{$component}--visible {
            transform: scale(1);
        }
    }
}

// Dialog icon (optional, MD3 spec)
// Centered above headline, 24dp, secondary color
.#{$component}-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
    color: t.color("secondary");

    svg,
    .#{$component}-icon-content {
        width: 24px;
        height: 24px;
    }

    // When icon is present, header should be centered
    & + .#{$component}-header {
        .#{$component}-header-content {
            text-align: center;
        }

        .#{$component}-header-title {
            text-align: center;
        }

        .#{$component}-header-subtitle {
            text-align: center;
        }
    }
}

// Dialog header
.#{$component}-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    padding: 24px 24px 16px 24px;

    // When following an icon, reduce top padding
    .#{$component}-icon + & {
        padding-top: 16px;
    }

    &-content {
        flex: 1;
    }

    &-title {
        margin: 0;
        color: t.color("on-surface");
        @include m.typography("headline-small");
    }

    &-subtitle {
        margin: 4px 0 0 0;
        @include m.typography("body-medium");
        color: t.color("on-surface-variant");
    }

    &-close {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        margin: -8px -8px 0 0;
        padding: 8px;
        background: transparent;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        color: t.color("on-surface-variant");
        transition: background-color v.motion("duration-short2")
            v.motion("easing-standard");

        &:hover {
            background-color: t.alpha("on-surface", 0.08);
        }

        &:focus {
            outline: none;
            background-color: t.alpha("on-surface", 0.12);
        }

        &:focus-visible {
            outline: 2px solid t.color("primary");
            outline-offset: 2px;
        }

        &:active {
            background-color: t.alpha("on-surface", 0.12);
        }

        svg {
            width: 24px;
            height: 24px;
        }
    }

    // RTL Support
    @include m.rtl {
        &-close {
            margin: -8px 0 0 -8px;
        }
    }
}

// Dialog content
// MD3: Body medium typography, on-surface-variant for supporting text
.#{$component}-content {
    padding: 16px 24px;
    color: t.color("on-surface-variant");
    @include m.typography("body-medium");

    // Scrollable content support
    overflow-y: auto;
    max-height: 60vh;
    @include m.scrollbar;

    p {
        margin: 0 0 16px 0;

        &:last-child {
            margin-bottom: 0;
        }
    }

    // When content needs emphasis, use on-surface
    &--emphasis {
        color: t.color("on-surface");
    }
}

// Dialog footer
// MD3: Actions right-aligned, 8dp gap, text buttons preferred
.#{$component}-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 16px 24px 24px 24px;
    gap: 8px;

    &--left {
        justify-content: flex-start;
    }

    &--center {
        justify-content: center;
    }

    &--space-between {
        justify-content: space-between;
    }

    // Stacked buttons for long text (MD3 spec)
    &--stacked {
        flex-direction: column-reverse;
        align-items: stretch;
        gap: 8px;
    }
}

// Dialog divider styling
// MD3: outline-variant color for dividers
.#{$component}-header-divider,
.#{$component}-footer-divider {
    margin: 0;
    border: none;
    height: 1px;
    background-color: t.color("outline-variant");
}

// Accessibility - Reduced motion preference support
@include m.reduced-motion {
    .#{$component},
    .#{$component}-overlay {
        transition: opacity 0.1s linear;
        transform: none !important;
    }

    .#{$component}--visible {
        transform: none !important;
    }
}

// High contrast mode
@include m.high-contrast {
    .#{$component} {
        border: 2px solid CurrentColor;
    }

    .#{$component}-header-divider,
    .#{$component}-footer-divider {
        background-color: CurrentColor;
    }

    .#{$component}-header-close:focus-visible {
        outline: 2px solid CurrentColor;
    }
}

// Mobile responsiveness
// MD3: Dialogs may become full-width sheets on mobile
@media (max-width: v.breakpoint("sm")) {
    .#{$component} {
        min-width: 280px;
        width: calc(100% - 32px);
        max-width: 100%;
        margin: 16px;

        // Mobile dialogs animate from bottom
        transform-origin: bottom center;

        &--fullscreen {
            width: 100%;
            height: 100%;
            margin: 0;
            transform-origin: center center;
        }
    }

    .#{$component}-overlay {
        padding: 16px;
        align-items: flex-end;

        &.#{$component}--fullscreen {
            padding: 0;
        }
    }

    .#{$component}-content {
        max-height: 50vh;
    }

    // Adjust animations for mobile - slide up from bottom
    .#{$component}--slide-up {
        transform-origin: bottom center;
        transform: scaleY(0);

        &.#{$component}--visible {
            transform: scaleY(1);
        }
    }

    // Stacked footer buttons on mobile when needed
    .#{$component}-footer--responsive {
        flex-direction: column-reverse;
        align-items: stretch;
    }
}

// Print styles
@media print {
    .#{$component}-overlay {
        position: static;
        background: none;
        padding: 0;
    }

    .#{$component} {
        box-shadow: none;
        border: 1px solid #000;
        max-width: 100%;
        transform: none;
        opacity: 1;
    }
}
